<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歌人ポートフォリオ</title>
    <!-- Google Fonts: 読みやすさと情緒を両立する明朝体 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #1a1a1a;
            --accent-color: #666666;
        }
        body {
            font-family: 'Noto Serif JP', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
        }
        .nav-link {
            position: relative;
            transition: color 0.3s;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 1px;
            bottom: -2px;
            left: 0;
            background-color: var(--text-color);
            transition: width 0.3s;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .content-section {
            display: none; /* 初期状態は非表示 */
            animation: fadeIn 0.8s ease-out forwards;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .tanka-line {
            margin-bottom: 1.5rem;
            letter-spacing: 0.05em;
        }
        .works-grid {
            border-left: 1px solid #eee;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- ナビゲーション -->
    <nav class="fixed top-0 w-full bg-white/80 backdrop-blur-md z-50 border-b border-gray-100">
        <div class="max-w-5xl mx-auto px-6 py-4 flex flex-wrap justify-between items-center">
            <a href="#" onclick="showPage('home')" class="text-xl font-medium tracking-widest">名前 / 歌人</a>
            <div class="flex gap-6 text-sm overflow-x-auto" id="main-nav">
                <a href="#" onclick="showPage('home')" class="nav-link">Home</a>
                <!-- 連作メニューはJSで動的に追加 -->
                <a href="#" onclick="showPage('works')" class="nav-link">Works</a>
                <a href="#" onclick="showPage('link')" class="nav-link">Link</a>
                <a href="#" onclick="showPage('contact')" class="nav-link">Contact</a>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <main class="flex-grow pt-32 pb-20 px-6 max-w-3xl mx-auto w-full">
        
        <!-- Home: プロフィール -->
        <section id="home" class="content-section">
            <h2 class="text-2xl mb-8 tracking-widest">Profile</h2>
            <div id="profile-text" class="space-y-6 text-gray-700">
                <!-- GASから取得 -->
                <p>読み込み中...</p>
            </div>
        </section>

        <!-- 連作表示エリア (動的に切り替わる) -->
        <section id="renusaku-template" class="content-section">
            <h2 id="renusaku-title" class="text-2xl mb-12 tracking-widest text-center"></h2>
            <div id="renusaku-content" class="space-y-12 text-center md:text-left">
                <!-- 短歌がここに並ぶ -->
            </div>
        </section>

        <!-- Works: 活動履歴 -->
        <section id="works" class="content-section">
            <h2 class="text-2xl mb-8 tracking-widest">Works</h2>
            <div id="works-list" class="space-y-8 works-grid pl-6">
                <!-- GASから取得 -->
            </div>
        </section>

        <!-- Link: SNS等 -->
        <section id="link" class="content-section">
            <h2 class="text-2xl mb-8 tracking-widest">Link</h2>
            <div id="links-container" class="grid gap-4">
                <!-- GASから取得 -->
            </div>
        </section>

        <!-- Contact: フォーム -->
        <section id="contact" class="content-section">
            <h2 class="text-2xl mb-8 tracking-widest">Contact</h2>
            <p class="mb-8 text-sm text-gray-600">お仕事のご依頼やお問い合わせは、以下のフォームよりお送りください。</p>
            <div class="aspect-video w-full">
                <!-- Googleフォームの埋め込み用iframe -->
                <iframe 
                    id="contact-form"
                    src="" 
                    width="100%" 
                    height="800" 
                    frameborder="0" 
                    marginheight="0" 
                    marginwidth="0">読み込み中…</iframe>
            </div>
        </section>

    </main>

    <footer class="py-10 text-center text-xs text-gray-400">
        <p>&copy; <span id="year"></span> Name All Rights Reserved.</p>
    </footer>

    <script>
        // --- 設定 ---
        // 先ほどデプロイしたGASのURLをここに反映済み
        const GAS_URL = "https://script.google.com/macros/s/AKfycbw-4ORzhR9VZE70928Nv6DvJaa5m_YnKQUA9TkgaJ6B_8NP4CQ8hsmB_NQ7LrQkQ1EV/exec";
        const GOOGLE_FORM_URL = ""; // Googleフォームの「送信」→「埋め込みHTML」のURLを入れる
        
        // ページ切り替えロジック
        function showPage(pageId, extraData = null) {
            // 全セクションを非表示
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            
            if (pageId.startsWith('renusaku-')) {
                const section = document.getElementById('renusaku-template');
                renderRenusaku(pageId.replace('renusaku-', ''), extraData);
                section.classList.add('active');
            } else {
                const section = document.getElementById(pageId);
                if (section) section.classList.add('active');
            }
            window.scrollTo(0, 0);
        }

        // 連作のレンダリング
        function renderRenusaku(id, allData) {
            const titleElement = document.getElementById('renusaku-title');
            const contentElement = document.getElementById('renusaku-content');
            
            // allDataから該当する連作の作品だけを抽出
            const title = allData.pages.find(p => p.id === id)?.title;
            const verses = allData.verses.filter(v => v.pageId === id);
            
            titleElement.innerText = title;
            contentElement.innerHTML = verses.map(v => `
                <div class="tanka-line">
                    ${v.note ? `<span class="text-xs text-gray-400 block mb-2">${v.note}</span>` : ''}
                    <p class="text-lg leading-relaxed">${v.content.replace(/\n/g, '<br>')}</p>
                </div>
            `).join('');
        }

        // 初期データ取得
        async function init() {
            document.getElementById('year').innerText = new Date().getFullYear();
            if (GOOGLE_FORM_URL) document.getElementById('contact-form').src = GOOGLE_FORM_URL;

            // GAS連携がまだの場合はダミーデータを表示
            if (!GAS_URL) {
                console.log("GAS_URLが設定されていません。");
                // デモ用にHomeを表示
                showPage('home');
                return;
            }

            try {
                const res = await fetch(GAS_URL);
                const data = await res.json();
                
                // 1. ナビゲーションの動的生成（連作分）
                const nav = document.getElementById('main-nav');
                const worksLink = nav.querySelector('a[onclick="showPage(\'works\')"]');
                
                data.pages.filter(p => p.type === 'Renusaku').forEach(p => {
                    const a = document.createElement('a');
                    a.href = "#";
                    a.className = "nav-link px-2";
                    a.innerText = p.title;
                    a.onclick = () => showPage(`renusaku-${p.id}`, data);
                    nav.insertBefore(a, worksLink);
                });

                // 2. Profile(Home)の反映
                const homeData = data.pages.find(p => p.type === 'Home');
                document.getElementById('profile-text').innerHTML = homeData.text.replace(/\n/g, '<br>');

                // 3. Worksの反映
                const worksContainer = document.getElementById('works-list');
                worksContainer.innerHTML = data.works.map(w => `
                    <div class="relative pl-4">
                        <span class="text-xs text-gray-400">${w.year}</span>
                        <h3 class="text-md font-medium">${w.content}</h3>
                        ${w.linkUrl ? `<a href="${w.linkUrl}" target="_blank" class="text-xs text-blue-400 hover:underline">Link</a>` : ''}
                    </div>
                `).join('');

                // 4. Linksの反映
                const linksContainer = document.getElementById('links-container');
                linksContainer.innerHTML = data.links.map(l => `
                    <a href="${l.url}" target="_blank" class="p-4 border border-gray-100 hover:bg-gray-50 transition flex justify-between items-center">
                        <span>${l.name}</span>
                        <span class="text-xs text-gray-400">→</span>
                    </a>
                `).join('');

                showPage('home');

            } catch (e) {
                console.error("Data load error:", e);
                document.getElementById('profile-text').innerText = "データの読み込みに失敗しました。";
            }
        }

        window.onload = init;
    </script>
</body>
</html>
